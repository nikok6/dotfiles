#!/bin/bash
{{ if eq .machineType "devcontainer" -}}
# In devcontainer: keep existing .zshrc and append our config
cat
cat <<'CHEZMOI_APPEND'

# --- chezmoi managed ---
ZSH_THEME="refined"
plugins=(git zsh-autosuggestions zsh-syntax-highlighting)
source $ZSH/oh-my-zsh.sh
export TERM=xterm-256color
alias reload='source ~/.zshrc'
alias cc="claude"
alias ccc="claude -c"
alias ccr="claude -r"
CHEZMOI_APPEND
{{ else -}}
# On other machines: replace .zshrc entirely
cat <<'CHEZMOI_REPLACE'
# Path to your Oh My Zsh installation.
export ZSH="$HOME/.oh-my-zsh"

ZSH_THEME="refined"

{{ if eq .machineType "work" -}}
plugins=(git docker zsh-autosuggestions zsh-syntax-highlighting)
{{ else -}}
plugins=(git zsh-autosuggestions zsh-syntax-highlighting)
{{ end -}}

source $ZSH/oh-my-zsh.sh

{{ if eq .machineType "work" -}}
[ -f "$HOME/.secrets.zsh" ] && source "$HOME/.secrets.zsh"
source ${ENSUREIT_DIR}/bin/setenv.sh

# Docker CLI completions
fpath=($HOME/.docker/completions $fpath)
autoload -Uz compinit
if [[ -n ~/.zcompdump(#qN.mh+24) ]]; then
  compinit
else
  compinit -C
fi

# Devcontainer aliases
devcrun() { devcontainer exec --workspace-folder . "$@" }
alias devczsh='devcrun zsh'
alias devcup='devcontainer up --workspace-folder . --dotfiles-repository https://github.com/nikok6/dotfiles --mount "source=${HOME}/.aws,target=/root/.aws,type=bind"'
alias devcstop='docker stop $(docker ps -q --filter "label=devcontainer.local_folder=$(pwd)")'
alias devcrm='docker rm -f $(docker ps -aq --filter "label=devcontainer.local_folder=$(pwd)")'
alias devcst='docker ps --filter "label=devcontainer.local_folder=$(pwd)" --format "{{.Names}}\t{{.Status}}"'
alias devcrb='devcontainer rebuild --workspace-folder .'

{{ end -}}

# Consolidated PATH
export PATH="$HOME/.bun/bin:$HOME/.local/bin:$PATH"

# zoxide (smarter cd)
eval "$(zoxide init zsh)"

# eza (modern ls)
alias ls='eza --icons'
alias ll='eza -l --icons'
alias la='eza -la --icons'

# bat (better cat)
alias cat='bat'
export MANPAGER="sh -c 'col -bx | bat -l man -p'"

# Unlock keychain
alias unlock='security unlock-keychain'

# Reload zsh config
alias reload='source ~/.zshrc'

# Claude Code aliases
alias cc="claude"
alias ccc="claude -c"
alias ccr="claude -r"
CHEZMOI_REPLACE
{{ end -}}
